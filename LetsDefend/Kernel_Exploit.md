# LetsDefend Walkthrough: Kernel Exploit Challenge
***https://medium.com/@anshumansingh_71873/letsdefend-walkthrough-a8851d7e34c1***

![kernel-exp-badge](https://github.com/user-attachments/assets/a6f7ad16-d9ca-4822-9ef4-252308fd9ac1)

## Challenge Overview
***https://app.letsdefend.io/challenge/kernel-exploit***

***Scenario:** In the afternoon, network monitoring systems detected anomalous traffic patterns originating from a critical transaction processing server. Initial signs suggest a potential security breach. You have been provided with a forensic image of the affected system and tasked with conducting a thorough investigation to determine the scope of the incident.*

***File location:** /root/Desktop/ChallengeFile/linuxTriageImage.tar.zip*

***File Password:** infected*

***System Type:** Linux-based transaction server*

***Observed Symptoms:** Anomalous network traffic detected*

***Suspected Cause:** Kernel exploit used for privilege escalation*

***Artifacts Provided:** Files collected using the Unix-like Artifacts Collector (UAC), including live forensic data and system command outputs.*

## Solution
What we have for this challenge is a collection of artifacts gathered by the Unix-like Artifacts Collector (UAC). These served as a starting point for our investigation.

![image](https://github.com/user-attachments/assets/4633b226-b313-4906-977b-bc57ee720589)

Understanding what data is available helped prioritize which artifacts to investigate. Given the challenge’s focus on anomalous traffic and privilege escalation, the investigation began with process data to locate suspicious activity. The process-related data was found in `live_response/process` where a process named `./exploit` stood out:

![image](https://github.com/user-attachments/assets/185c590b-6ab5-42dd-980f-a6e030f3063c)

***Question - What is the name of the key file the intruder downloaded to elevate their privileges after gaining unauthorized access?***

```bash
exploit
```
With the suspicious process identified, the next step was to locate the actual binary file on disk and determine its origin. The process ran from `/tmp`, a directory often used for temporary storage and by attackers to execute payloads.

![image](https://github.com/user-attachments/assets/4b868f80-8574-48ee-8156-bd0d33be14d4)

After navigating to the `/[root]/tmp` directory in the forensic image, we can get the binary and calculate its hash for further analysis.

![image](https://github.com/user-attachments/assets/503cb6ed-9f0d-442d-9360-677c9f504eab)

Hashing allows for searching threat intelligence platforms like ***VirusTotal*** for prior reports and metadata.

Uploading the hash to VirusTotal revealed quite a few ***Details*** found under the ***History*** section.

![image](https://github.com/user-attachments/assets/17d52c87-b9e9-49de-a17c-1b7e57f6a4ef)

***Question - When was the file used for privilege escalation first submitted on Virus Total?***

```bash
2024-03-26 16:45:52 UTC
```

***Question - What is the Process ID (PID) of the operation launched by the attacker?***

```bash
31671
```

***Question - What username was the malicious process running under?***

```bash
a1l4m
```

***Question - What is the Parent Process ID (PPID) associated with the malicious process?***

```bash
1686
```

![image](https://github.com/user-attachments/assets/7131642c-b898-4542-957f-daa7d165efa5)

From `live_response/system`, the output of the `uname` command revealed the ***Operating System*** and the ***Kernel Version***. Identifying the version helps pinpoint the exploited CVE.

***Question - What are the operating system and its version on the compromised server?***

```bash
22.04.1-Ubuntu
```

***Question - What is the kernel version of the compromised system?***

```bash
6.5.0-27-generic
```

![image](https://github.com/user-attachments/assets/900ef414-0d12-4109-ac71-06c31a06c8df)

Returning to the VirusTotal report for the `./exploit` binary, the platform linked two CVEs (Common Vulnerabilities and Exposures) to the file with the most relevant one being ***CVE-2024–1086***. It affects Linux kernel versions 3.15 to 6.1.76, 6.2 to 6.6.15, and 6.7 to 6.7.3 which falls within the affected range, confirming the vulnerability’s role in the breach. Also, this file exploits a vulnerability allowing attackers to escalate privileges, exactly what we were looking for!

***Question - What is the most recent CVE number associated with the vulnerabilities exploited in this attack?***

```bash
CVE-2024-1086
```

![image](https://github.com/user-attachments/assets/07d1bb70-e66f-4689-981b-189c83186d07)
